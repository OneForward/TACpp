# [Qtå®è·µ-2048æ¸¸æˆ](https://gitee.com/OneForward/TACpp/blob/gitee/tutorials/qt-2048-v1.md)

* [Qtå®è·µ-2048æ¸¸æˆæ•™ç¨‹(1): GameBoard æ¨¡å—](https://gitee.com/OneForward/TACpp/blob/gitee/tutorials/qt-2048-v1.md)
* [Qtå®è·µ-2048æ¸¸æˆæ•™ç¨‹(2): Cell æ¨¡å—](https://gitee.com/OneForward/TACpp/blob/gitee/tutorials/qt-2048-v2.md)
* [Qtå®è·µ-2048æ¸¸æˆæ•™ç¨‹(3): Game æ¨¡å—](https://gitee.com/OneForward/TACpp/blob/gitee/tutorials/qt-2048-v3.md)


æœ¬æ•™ç¨‹å°†ä½¿ç”¨Qtçš„GUIç»„ä»¶å†™ä¸€ä¸ªç®€å•çš„2048æ¸¸æˆï¼Œå¸Œæœ›èƒ½å¸®åŠ©åŒå­¦ä»¬åˆæ­¥æ„Ÿå—ä¸€ä¸‹Qtç»˜åˆ¶ç•Œé¢çš„ç¼–ç¨‹ç‰¹ç‚¹ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹

![](imgs/qt-2048-æœ€ç»ˆæ•ˆæœ.png)

æœ¬é¡¹ç›®æºä»£ç ç”± github å’Œ gitee æ‰˜ç®¡ã€‚ ç‚¹å‡» [ğŸ‘‰ Github æºä»£ç é“¾æ¥](https://github.com/OneForward/TACpp/archive/refs/heads/gitee.zip) æˆ–è€… [ Gitee æºä»£ç é“¾æ¥](https://gitee.com/OneForward/TACpp/repository/archive/gitee.zip)  ä¸‹è½½ã€‚

ä¸‹è½½åï¼Œåœ¨ labs æ–‡ä»¶å¤¹ä¸‹ï¼Œä½¿ç”¨ Qt æ‰“å¼€ç›¸åº”çš„ .pro å·¥ç¨‹æ–‡ä»¶å³å¯è¿è¡Œäº†ã€‚

## æ–°å»ºQté¡¹ç›®

<details>
  <summary> æ–°å»ºQté¡¹ç›®çš„å…·ä½“æ­¥éª¤ã€ç‚¹å¼€å°ä¸‰è§’å½¢æŸ¥çœ‹ã€‘ </summary>

æŒ‰ä½ `Crtl Shift N` æ–°å»ºå·¥ç¨‹é¡¹ç›®ã€‚

* ç‚¹å‡»ç¡®å®šã€‚

![](imgs/qt-new-proj-widgets.png)

* è®¾ç½®å·¥ç¨‹åã€‚

![](imgs/qt-new-proj.png)

* ä¸€è·¯ç‚¹å‡»é»˜è®¤é€‰é¡¹ã€‚é™¤äº†æ­¤å¤„ï¼Œä¸å‹¾é€‰ ui formã€‚

![](imgs/qt-new-proj-no-ui.png)

æœ€ç»ˆæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚å›¾æ‰€ç¤ºçš„ä¸€ä¸ªé¡¹ç›®

![](imgs/qt2048-init.png)

æŒ‰ä½ `Ctrl R` è¿è¡Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ç»„ä»¶çš„ç•Œé¢ç¨‹åºã€‚

![](imgs/qt2048-init-run.png)


</details>

# Qtå®è·µ-2048æ¸¸æˆæ•™ç¨‹(1): GameBoard æ¨¡å—
é¦–å…ˆæˆ‘ä»¬ç»˜åˆ¶ 2048 æ¸¸æˆçš„ä¸»ç•Œé¢ï¼Œæ¥æ·»åŠ ä¸€ä¸ª GameBoard æ¨¡å—ã€‚

<details>
  <summary> åœ¨é¡¹ç›®ä¸­æ·»åŠ  GameBoard æ¨¡å—å…·ä½“æ­¥éª¤ </summary>

* å³é”®é¡¹ç›®åç§°ï¼Œç‚¹å‡» `Add New` æ·»åŠ ä¸€ä¸ªæ–°çš„ç±»ã€‚

![](imgs/Add-New.png)

![](imgs/Add-New-Class.png)

* æˆ‘ä»¬å¸Œæœ› GameBoard æ˜¯ä¸€ä¸ª QWidget ç»„ä»¶ï¼Œç”¨äºç››æ”¾æ¸¸æˆä¸»ç•Œé¢çš„å…¶ä»–å°ç»„ä»¶ã€‚é…ç½®å¦‚ä¸‹

![](imgs/Add-New-GameBoard.png)

* å®Œæˆåï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¼šå¢åŠ  gameboard.h å’Œ gameboard.cpp ä¸¤ä¸ªæ–‡ä»¶ã€‚

![](imgs/Add-New-GameBoard-ç»“æœ.png)
</details>



æ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ ç»˜åˆ¶ä¸»ç•Œé¢ä»£ç ï¼ˆç‚¹å¼€å°ä¸‰è§’å½¢å¯ä»¥æŸ¥çœ‹ä»£ç ï¼‰ã€‚


<details>
  <summary> gameboard.h  </summary>

```cpp
// gameboard.h 
#ifndef GAMEBOARD_H
#define GAMEBOARD_H

#include <QLabel>
#include <QVBoxLayout>
#include <QGridLayout>

class GameBoard : public QWidget
{
    Q_OBJECT
public:
    explicit GameBoard(QWidget *parent = 0);

private:

    // main layout
    QVBoxLayout *mainLayout;
    // grid layout of board
    QGridLayout *boardLayout;
    // score widget
    QLabel *score;

};

#endif // GAMEBOARD_H
```

</details>

<details>
  <summary> gameboard.cpp  </summary>

```cpp
// gameboard.cpp 
#include "gameboard.h"

GameBoard::GameBoard(QWidget *parent) :
    QWidget(parent)
{
    // set default size
    resize(650,450);

    // create the main layout
    mainLayout = new QVBoxLayout();
    setLayout(mainLayout);

    // create the board layout
    boardLayout = new QGridLayout();

    auto cell = new QLabel();
    cell->setText("2");
    cell->setAlignment(Qt::AlignCenter);
    cell->setStyleSheet("QLabel { background: rgb(238,228,218); color: rgb(119,110,101); font: bold; border-radius: 10px; font: 40pt; }");
    boardLayout->addWidget(cell);

    mainLayout->insertLayout(0, boardLayout);

    // create the score widget and add it to the board
    score = new QLabel(QString("SCORE: %1").arg(0));
    score->setStyleSheet("QLabel { color: rgb(235,224,214); font: 16pt; }");
    score->setFixedHeight(50);
    mainLayout->insertWidget(1, score, 0, Qt::AlignRight);

    // style sheet of the board
    setStyleSheet("GameBoard { background-color: rgb(187,173,160) }");
}
```

</details>

<details>
  <summary> main.cpp </summary>

```cpp
// main.cpp
#include <QApplication>
#include "gameboard.h"

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    GameBoard board;
    board.show();

    return app.exec();
}
```

</details>



å°†ä»£ç å¤åˆ¶ç²˜è´´è¿›å»åï¼ŒæŒ‰ä½ `Ctrl R` ç¼–è¯‘è¿è¡Œï¼Œæˆ‘ä»¬å¾—åˆ°é¢„æœŸæ•ˆæœå¦‚ä¸‹

![](imgs/qt2048-v1-æ•ˆæœ.png)

æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€è¡Œè§£é‡Šè¿™äº›ä»£ç çš„å«ä¹‰ã€‚

### çŸ¥è¯†ç‚¹

### `Q_OBJECT` å®

`Q_OBJECT` å®ç”¨äºæä¾› Qt ä¸­çš„ä¿¡å·é‡å’Œæ§½æœºåˆ¶(Signals and Slots)ã€‚æš‚æ—¶å¯ä»¥ä¸å¿…æ·±ç©¶ç»†èŠ‚ã€‚



### QWidgets 

**Widget** æ˜¯Qtä¸­åˆ›å»ºç”¨æˆ·ç•Œé¢çš„ä¸»è¦å…ƒç´ ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºæ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œå¹¶ä¸ºå…¶ä»–åº”è¯¥ç»„åˆåœ¨ä¸€èµ·çš„ Widget æä¾›ä¸€ä¸ªå®¹å™¨ï¼ˆå¯ä»¥å †å ç››æ”¾å…¶ä»–çš„ Widgets ï¼‰ã€‚æœ€å¤–å±‚çš„ Widget ç§°ä¸º Windowã€‚

![](imgs/widget-example.png)


æœ‰å“ªäº›å¸¸è§çš„ Widget å‘¢ï¼Œ [widget-classes](https://doc.qt.io/qt-5/widget-classes.html#basic-widget-classes) å±•ç¤ºäº†å¤§é‡çš„ Qt åŸç”Ÿçš„ Widgetã€‚

æˆ‘ä»¬çš„æ¸¸æˆç•Œé¢ä¸»ä½“å°±æ˜¯ä» QWidget ç»§æ‰¿èµ·æ¥çš„ä¸€ä¸ªç»„ä»¶ã€‚

```cpp
class GameBoard : public QWidget {...}
```

### QLayout 

* QHBoxLayout å°† Widget æŒ‰æ°´å¹³è¡Œæ’åˆ—ï¼Œä»å·¦åˆ°å³ã€‚

![](imgs/QHBoxLayout.png)

* QVBoxLayout å°† Widget æŒ‰å‚ç›´æ’åˆ—ï¼Œä»ä¸Šåˆ°ä¸‹ã€‚

![](imgs/QVBoxLayout.png)

* QGridLayout åœ¨äºŒç»´ç½‘æ ¼ä¸­å¸ƒå±€ Widgetã€‚Widget å¯ä»¥å ç”¨å¤šä¸ªå•å…ƒæ ¼ã€‚

![](imgs/QGridLayout.png)

### QLabel

QWidgets çš„ç»„ä»¶ä¹‹ä¸€ã€‚QLabel ç”¨äºæ˜¾ç¤ºæ–‡æœ¬æˆ–å›¾åƒã€‚

### Qt æ ·å¼è¡¨ `setStyleSheet`

å¤§éƒ¨åˆ† QWidgets éƒ½æ”¯æŒä¸°å¯Œçš„ æ ·å¼è¡¨è®¾ç½®ã€‚

å¦‚ä¸‹ä»£ç 
```cpp
    auto cell = new QLabel();
    cell->setText("2");
    cell->setAlignment(Qt::AlignCenter);
    cell->setStyleSheet("QLabel { background: rgb(238,228,218); color: rgb(119,110,101); font: bold; border-radius: 10px; font: 40pt; }");
```

* `setText` è®¾ç½®æ˜¾ç¤ºçš„æ–‡æœ¬ã€‚æ­¤å¤„ä¸º `"2"`
* `setAlignment` è®¾ç½®å¯¹é½æ¨¡å¼ã€‚æ­¤å¤„ä¸ºä¸­å¿ƒå¯¹é½ `Qt::AlignCenter`
* `setStyleSheet` ä½¿ç”¨æ ·å¼è¡¨ã€‚æ­¤å¤„ä½¿ç”¨çš„æ˜¯å¦‚ä¸‹çš„æ ·å¼é…ç½®
    ```css
    QLabel { 
        background: rgb(238,228,218); 
        color: rgb(119,110,101); 
        font: bold, 40pt; 
        border-radius: 10px; 
    }
    ```

    * å«ä¹‰æ˜¯è®¾ç½® QLabel çš„ èƒŒæ™¯ é¢œè‰²æ˜¯ ![#eee4da](https://via.placeholder.com/16/eee4da/000000?text=+) rgb(238,228,218) 

    * å†…å®¹é¢œè‰²æ˜¯ ![#776e65](https://via.placeholder.com/15/776e65/000000?text=+) rgb(119,110,101)

    * å­—ä½“æ˜¯ ç²—ä½“, å¤§å° 40pt

    * è¾¹æ¡†ä¸ºåœ†è§’, åœ†è§’åŠå¾„æ˜¯ 10px



æ ·å¼æ•ˆæœå¦‚ä¸‹

![](imgs/qt2048-cell-2.png)

### GameBoard å¸ƒå±€çš„é˜é‡Š

![](imgs/qt2048-v1-è§£é‡Š1x1.png)

æˆ‘ä»¬æ¥é˜…è¯»æºä»£ç ã€‚å°†å¸ƒå±€çš„éƒ¨åˆ†æŠ½å–å‡ºæ¥å¦‚ä¸‹

```cpp
    // create the main layout
    mainLayout = new QVBoxLayout();
    setLayout(mainLayout);

    // create the board layout
    boardLayout = new QGridLayout();

    auto cell = new QLabel("2");
    boardLayout->addWidget(cell);

    mainLayout->insertLayout(0, boardLayout);

    // create the score widget and add it to the board
    score = new QLabel("SCORE: 0");
    mainLayout->insertWidget(1, score, 0, Qt::AlignRight);
```

å¯ä»¥ç†è§£ä¸»è¦åšäº†è¿™ä¹ˆå‡ ä»¶å·¥ä½œ

1. æ„é€ ä¸€ä¸ª `QVBoxLayout`, å‘½åä¸º `mainLayout`, å®ƒå°†ç•Œé¢è®¾ç½®æˆç«–ç›´æ–¹å‘çš„æ’å¸ƒæ¨¡å¼ã€‚

2. æ„é€ ä¸€ä¸ª `QGridLayout`, å‘½åä¸º `boardLayout`, å®ƒå°†ç”¨äºé…ç½®æ–¹å—çš„æ’å¸ƒæ¨¡å¼æ˜¯ç½‘æ ¼çŠ¶æ’å¸ƒã€‚æˆ‘ä»¬å°†æŠŠå®ƒæ’å…¥åœ¨ `mainLayout` çš„ä¸Šç«¯ã€‚

3. æ„é€ ä¸€ä¸ª `QLabel`, å‘½åä¸º `cell`, è¿™æ˜¯ä¸€ä¸ªå°æ–¹å—ã€‚æˆ‘ä»¬è®¾ç½®å®ƒæ˜¾ç¤ºçš„æ–‡æœ¬æ˜¯ `"2"`, æ’å…¥åœ¨ boardLayout ä¸­ã€‚

4. æ„é€ ä¸€ä¸ª `QLabel`, å‘½åä¸º `score`, è¿™æ˜¯ä¸€ä¸ªæ˜¾ç¤ºåˆ†æ•°çš„ç»„ä»¶ã€‚æˆ‘ä»¬è®¾ç½®å®ƒæ˜¾ç¤ºçš„æ–‡æœ¬æ˜¯ `"SCORE: 0"` , æ’å…¥åœ¨ `QGridLayout` çš„ä¸‹ç«¯ï¼Œä¸”é å³å¯¹é½ã€‚





### 4x4 çš„æ¸¸æˆé¢æ¿

å†™ä¸ªå¾ªç¯å°†å…¶ä¸­çš„ QGridLayout ç”¨ 4x4 çš„å°æ–¹å—å¡«å…… 

```cpp
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            auto cell = new QLabel();
            cell->setText("2");
            cell->setAlignment(Qt::AlignCenter);
            cell->setStyleSheet("QLabel { background: rgb(238,228,218); color: rgb(119,110,101); font: bold; border-radius: 10px; font: 40pt; }");
            boardLayout->addWidget(cell, i, j);
        }
    }
```

æˆ‘ä»¬æœ‰å¦‚ä¸‹æ•ˆæœ

![](imgs/qt2048-v1-è§£é‡Š.png)

å¥½äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæ¸¸æˆä¸»ç•Œé¢å°±ç”»å¥½äº†ã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨æ¯ä¸€ä¸ªå°æ–¹å— Cell ã€‚æˆ‘ä»¬çŸ¥é“2048æ¸¸æˆçš„å°æ–¹å—å¯ä»¥æ˜¯æ•°å­— {2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048} ï¼Œ æˆ‘ä»¬å¸Œæœ›ä¸ºæ¯ä¸€ä¸ªæ•°å­—å‘ˆç°ä¸åŒçš„é¢œè‰²ï¼Œå› æ­¤éœ€è¦è®¾è®¡ä¸€ç»„æ ·å¼è¡¨åˆ—è¡¨ã€‚

---


<details>
  <summary> é™„ï¼šåˆ å»ä¸éœ€è¦çš„ mainwindow æ¨¡å— </summary>

ç”±äºæˆ‘ä»¬çš„ä»£ç ä¸éœ€è¦ mainwindow æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ å» mainwindow.h å’Œ mainwindow.cpp ä¸¤ä¸ªæ–‡ä»¶ã€‚å³é”®æ–‡ä»¶åé€‰æ‹© `Remove` å³å¯ã€‚

![](imgs/qt2048-init-remove-mainwindow.png)

</details>




